# 06.ARMv8캐시(Cache)

### ARMv8 캐시구조

![](assets/2023-08-30-15-12-35-image.png)

1. **레벨(Level) 별 캐시**:
   
   - ARMv8 아키텍처에서는 여러 레벨의 캐시가 사용됨. 
   
   - 주로 L1, L2, L3 캐시로 구성 이 캐시들은 계층적으로 구성
   
   - L1 캐시는 보통 8~64KB 정도의 용량으로 CPU가 가장 빠르게 접근하게 되며, 여기서 데이터를 찾지 못하면, 이제 L2 캐시 메모리로 넘어감

2. **명령어 캐시(Instruction Cache)**:
   
   - 명령어 캐시는 프로세서가 명령어를 검색하고 실행하는 데 사용
   - 명령어를 캐시에 저장하여 프로세서가 빠르게 명령어를 가져올 수 있도록 함

3. **데이터 캐시(Data Cache)**:
   
   - 데이터 캐시는 프로세서의 데이터를 저장하는 데 사용.
   - 프로세서가 데이터를 읽거나 쓸 때, 이 데이터를 캐시에 저장하여 더 빠른 메모리 접근을 제공

4. **선호(Prefetch) 엔진**:
   
   - ARMv8 아키텍처는 데이터 및 명령어 캐시의 성능을 높이기 위해 선호 엔진을 포함
   - 이 엔진은 미리 읽어야 할 데이터 블록을 예측하여 캐시에 미리 로드하는 기능을 수행

5. **캐시 결합(Cache Coherency)**:
   
   - 멀티코어 시스템에서는 캐시 일관성이 중요
   - 캐시 일관성은 여러 개의 코어가 동일한 데이터에 접근할 때 데이터의 일관성을 유지하는 것을 의미

6. **캐시 크기와 구성**:
   
   - 각 레벨의 캐시는 크기와 조합에 따라 다양한 구성이 가능
   - 작은 크기의 L1 캐시는 빠른 접근 속도를 제공, 더 큰 크기의 L2 캐시는 더 많은 데이터를 저장할 수 있음

✖️

1. **ACP (Accelerator Coherency Port)**:
   
   - ACP는 ARM 기반 시스템에서 주변 장치와 캐시 사이의 데이터 일관성을 유지하기 위한 통로(HW)
   - 주변 장치가 캐시에 있는 데이터를 읽거나 쓸 때, ACP를 통해 이러한 동작이<u> 캐시 일관성을 유지</u>하며 수행됨

2. **SCU (Snoop Control Unit)**:
   
   - SCU는 멀티코어 시스템에서 **데이터 일관성을 관리**하는 역할 수행
   - SCU는 각 코어와 캐시 간의 **데이터 동기화와 캐시 일관성을 유지**하도록 도움

3. **ECC (Error Correction Code)**:
   
   - ECC는 메모리와 캐시의 데이터 무결성을 유지하기 위한 기술
   - 데이터 저장 시 일부 비트를 추가하여 **데이터 오류를 감지**하고 복구할 수 있는 기능을 제공함

4. AMBA 4 ACE: CCI를 활용한 캐시 동기화 처리

5. CCI: Cache Coherent Interconnect

![](assets/2023-08-30-15-35-18-image.png)

![](assets/2023-08-30-15-37-17-image.png)

![](assets/2023-08-30-15-37-25-image.png)<img src="assets/2023-08-30-15-40-12-image.png" title="" alt="" width="254"><img title="" src="assets/2023-08-30-15-42-59-image.png" alt="" width="317">

`PIPT(Physical Index, Physical Tag)`: CPU 캐시의 동작 모드 중 하나인 캐시 일관성 모드를 나타내는 약어 이 모드는 캐시와 메모리 간의 데이터 일관성을 관리하는 방식을 의미

![](assets/2023-08-30-15-52-02-image.png)

<br>

### ARMv8 L1 cache 추적과 메모리오더링 이해

![](assets/2023-08-30-15-52-22-image.png)

1. **순차실행 (Sequential Execution)**:
   
   - 순차실행은 코드가 작성된 순서대로 명령어가 실행되는 것
   - 하나의 명령어가 완료된 후에 다음 명령어가 실행됨 대부분의 프로그래밍 언어에서의 디폴트 동작

2. **비순차 실행 (Out-of-Order Execution)**:
   
   - 모던 프로세서는 성능 향상을 위해 명령어의 독립성을 파악하고, <u>순서가 바뀌어도 올바른 결과를 유지할 수 있는 경우</u> 명령어들을 재배치하여 실행

3. **예측실행 (Speculative Execution)**:
   
   - 프로세서는 분기 명령어의 결과를 예측하여 분기를 따라 미리 명령어를 실행 이를 통해 예측이 맞았을 때 지연시간을 줄이고 성능을 향상시킴

4. **예측 로딩 (Speculative Loading)**:
   
   - 분기 예측에 따라 미리 데이터를 로드하여 캐시에 저장하는 기술 분기 예측이 맞았을 때 데이터에 빠르게 접근할 수 있도록 함

5. **읽기쓰기 최적화 (Read-Write Optimization)**:
   
   - 프로세서는 데이터를 읽을 때 해당 데이터를 자주 사용한다고 판단하면 미리 로드하여 캐시에 저장하는 것. 성능을 향상시키는 데 도움이 됨

![](assets/2023-08-30-15-52-38-image.png)

1. **ISB (Instruction Synchronization Barrier)**
   
   - ISB는 명령어의 순서와 메모리 액세스의 순서를 동기화하는 데 사용
   - 이전에 실행한 명령어들의 결과가 메모리에 반영되기 전에 ISB를 사용하여 뒤따르는 명령어들이 실행되지 않도록 보장

2. **DMB (Data Memory Barrier)**
   
   - DMB는 데이터의 순서와 메모리 액세스의 순서를 동기화하는 데 사용
   - DMB를 사용하여 이전에 작성한 데이터가 메모리에 반영되기 전에 뒤따르는 데이터 쓰기 작업이 발생하지 않도록 보장

3. **DSB (Data Synchronization Barrier)**
   
   - DSB는 데이터와 명령어의 순서와 메모리 액세스의 순서를 동기화하는 데 사용
   - DSB를 사용하여 이전에 작성한 데이터와 명령어가 메모리에 반영되기 전에 뒤따르는 데이터 및 명령어 작업이 발생하지 않도록 보장
